 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fractal Machine</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; background-color: white; color: black; }
        canvas { border: 1px solid black; background-color: white; }
        .controls { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Fractal Machine</h1>
    <canvas id="fractalCanvas" width="600" height="600"></canvas>
    <div class="controls">
        <label>Iterations: <input type="number" id="iterations" value="5" min="1" max="10"></label>
        <label>Scale X: <input type="number" id="scaleX" value="0.7" step="0.1"></label>
        <label>Scale Y: <input type="number" id="scaleY" value="0.7" step="0.1"></label>
        <label>Rotation: <input type="number" id="rotation" value="30"></label>
        <label>Shear X: <input type="number" id="shearX" value="0" step="0.1"></label>
        <label>Shear Y: <input type="number" id="shearY" value="0" step="0.1"></label>
        <label>Offset X: <input type="number" id="offsetX" value="0"></label>
        <label>Offset Y: <input type="number" id="offsetY" value="0"></label>
        <button onclick="toggleInvertColors()">Invert Colors</button>
        <button onclick="startAnimation()">Start Animation</button>
        <button onclick="stopAnimation()">Stop Animation</button>
        <button onclick="setPolygon(3)">Triangle</button>
        <button onclick="setPolygon(4)">Square</button>
        <button onclick="setPolygon(5)">Pentagon</button>
        <button onclick="resetFractal()">Reset</button>
    </div>
    <script>
        const canvas = document.getElementById("fractalCanvas");
        const ctx = canvas.getContext("2d");
        let frame = 0;
        let invertColors = false;
        let animationFrame;
        let polygonSides = 3;

        function applyTransform(x, y, scaleX, scaleY, rotation, shearX, shearY, offsetX, offsetY) {
            return {
                x: x * scaleX + y * shearX + offsetX,
                y: x * shearY + y * scaleY + offsetY
            };
        }

        function drawPolygon(x, y, size, sides) {
            ctx.beginPath();
            for (let i = 0; i < sides; i++) {
                const angle = (Math.PI * 2 / sides) * i;
                const px = x + size * Math.cos(angle);
                const py = y + size * Math.sin(angle);
                ctx.lineTo(px, py);
            }
            ctx.closePath();
            ctx.stroke();
        }

        function drawFractalRecursive(x, y, length, angle, iterations) {
            if (iterations === 0) return;
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle * Math.PI / 180);
            drawPolygon(0, 0, length, polygonSides);
            ctx.restore();

            const scaleX = parseFloat(document.getElementById("scaleX").value);
            const scaleY = parseFloat(document.getElementById("scaleY").value);
            const rotation = parseFloat(document.getElementById("rotation").value) + frame;
            const shearX = parseFloat(document.getElementById("shearX").value);
            const shearY = parseFloat(document.getElementById("shearY").value);
            const offsetX = parseFloat(document.getElementById("offsetX").value);
            const offsetY = parseFloat(document.getElementById("offsetY").value);

            const transformed1 = applyTransform(x, y, scaleX, scaleY, rotation, shearX, shearY, offsetX, offsetY);
            const transformed2 = applyTransform(x, y, scaleX, scaleY, -rotation, shearX, shearY, -offsetX, -offsetY);
            
            drawFractalRecursive(transformed1.x, transformed1.y, length * scaleX, angle + rotation, iterations - 1);
            drawFractalRecursive(transformed2.x, transformed2.y, length * scaleY, angle - rotation, iterations - 1);
        }

        function animateFractal() {
            frame += 1;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = invertColors ? "white" : "black";
            drawFractalRecursive(canvas.width / 2, canvas.height / 2, 150, -90, parseInt(document.getElementById("iterations").value));
            animationFrame = requestAnimationFrame(animateFractal);
        }

        function startAnimation() {
            if (!animationFrame) {
                animateFractal();
            }
        }

        function stopAnimation() {
            cancelAnimationFrame(animationFrame);
            animationFrame = null;
        }

        function toggleInvertColors() {
            invertColors = !invertColors;
            document.body.style.backgroundColor = invertColors ? "black" : "white";
            document.body.style.color = invertColors ? "white" : "black";
            canvas.style.backgroundColor = invertColors ? "black" : "white";
        }

        function setPolygon(sides) {
            polygonSides = sides;
            resetFractal();
        }

        function resetFractal() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = invertColors ? "white" : "black";
            drawFractalRecursive(canvas.width / 2, canvas.height / 2, 150, -90, parseInt(document.getElementById("iterations").value));
        }
